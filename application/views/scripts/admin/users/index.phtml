<h2>Admin - Users</h2>
<?php
echo $this->partial('admin/head-navi.phtml');
$addUserUrl = $this->baseUrl() . '/admin_users/edit/id/0';
?>
<form action="<?php echo $this->baseUrl();?>/admin_users/" method="post" id="myForm">
    <p style="margin:0;padding:0;">
        <input type="hidden" id="offset" name="offset" value="<?php echo $this->offset;?>" />
        Filter / Search:
        <input type="text" class="text" id="filterUser" name="filterUser" value="<?php echo $this->escape($this->filterUser);?>" />
        <button type="submit" class="Formbutton" value="Search" onclick="resetOffset();">
            <?php echo $this->getIcon('search', '', 16);?> Search
        </button>
        <button type="submit" class="Formbutton" onclick="$('#filterUser').val('');resetOffset();">
            <?php echo $this->getIcon('delete', '');?> Reset
        </button>
        <?php if ($this->user->hasRight('addUser')) { ?>
            <button type="button" class="Formbutton" onclick="window.location.href='<?php echo $addUserUrl;?>'">
                <?php echo $this->getIcon('plus', '');?> Add user
            </button>
        <?php } ?>
        <br /><br />

        <a href="#" <?php if($this->offset > 0): ?> title="Shortcut ALT+C"
            onclick="mySubmit('offset', '<?php echo $this->offset-$this->recordsPerPage;?>');"
            accesskey="c" class="Formbutton"><?php echo $this->getIcon('Back', '', 16);?>
            <?php else: ?>
            class="Formbutton"><?php echo $this->getIcon('BackDisabled', '', 16);?>
            <?php endif; ?>
        </a>

        <a href="#" <?php if($this->offset + $this->recordsPerPage < $this->hits): ?> title="Shortcut ALT+V"
            onclick="mySubmit('offset', '<?php echo $this->offset+$this->recordsPerPage;?>');"
            accesskey="v" class="Formbutton"><?php echo $this->getIcon('Forward', '', 16);?>
            <?php else: ?>
            class="Formbutton"><?php echo $this->getIcon('ForwardDisabled', '', 16);?>
            <?php endif; ?>
        </a>
        Entries per page:
        <select name="recordsPerPage" onchange="setPageInactive();;resetOffset();$('#myForm').submit();">
            <?php echo $this->selRecordsPerPage;?>
        </select>
        Hits: <?php echo $this->numberFormat($this->hits);?>
        <input type="hidden" name="deleteUser" id="deleteUser" value="0"/>
    </p>
</form>

<table class="bdr small" summary="Userlist">
    <tr class="thead">
        <th>&nbsp;</th>
        <th>#</th>
        <th>Username</th>
        <th>Active</th>
        <th>Can edit</th>
    </tr>
<?php

$i = 1;
if ($this->hits == 0) { ?>
    <tr class="row-odd">
        <td colspan="6" class="error">Sorry, no hits.</td>
    </tr>

<?php
}
foreach ($this->users as $userId => $user)
{
    $i += $this->offset;
    $cycleHelper = $this->cycle(array('row-even', 'row-odd'));
    $edit = '<a href="'.$this->baseUrl().'/admin_users/edit/id/'.$userId .'" title="Edit user">';
    ?>
    <tr class="<?php echo $cycleHelper->next();?>">
        <td>
            <?php echo $edit . $this->getIcon('Edit', '');?></a>
            <?php if ($this->user->hasRight('deleteUsers')) { ?>
                <a href="#" id="deleteUser-<?php echo $userId;?>" class="deleteUser" title="Delete user">
                    <?php echo $this->getIcon('delete', '');?>
                </a>
            <?php } ?>
        </td>
        <td class="right">
            <?php echo $this->numberFormat($i);?>.
        </td>
        <td><?php echo $edit . $user['username'];?></a></td>
        <td>
            <?php
                if ($user['active'] == 1) {
                    echo $this->getIcon('Ok', $this->lang->L_YES, 16);
                } else {
                    echo $this->getIcon('NotOk', $this->lang->L_NO, 16);
                };
            ?>
        </td>
        <td>
            <?php
                $languageEditRights = $this->userModel->getUserLanguageRights($userId, false);
                if (empty($languageEditRights)) {
                    echo '<i>Nothing</i>';
                }
            ?>
            <table summary="Flags of edit languages">
            <tr>
                <?php
                foreach ($languageEditRights as $langId) {
                if (isset($this->languages[$langId])) {
                ?>
                    <td>
                        <?php echo $this->printFlag($langId, 20);?>
                    </td>
                    <td><?php echo $this->languages[$langId]['locale'];?></td>
                    <td><?php echo $this->languages[$langId]['name'];?></td>
            <?php
                }
            } ?>
            </tr>
            </table>
        </td>
    </tr>
    <?php
    $i++;
}
?>
</table>
<div id="confirmDeleteUser" style="display:none">
    Are you really sure you want to delete this user?<br />
    This will also remove all rights, settings and log entries of this user.
</div>
<?php $this->jQuery()->onLoadCaptureStart(); ?>
$('.deleteUser').click(function() {
    var a=this;
    $('#confirmDeleteUser').dialog({
        autoOpen: true,
        modal: true,
        title: 'Really delete?',
        width: 380,
        height: 160,
        buttons : {
                    "Yes, delete user": function() {
                        var id = a.id.replace(/deleteUser-/, '');
                        $('#deleteUser').attr('value', id);
                        $('#myForm').submit();
                    },
                    "Cancel": function() {
                        $(this).dialog("close");
                    }
                  }
    })
});
<?php
if (isset($this->userDeleted)) {
    if ($this->userDeleted == true) {
        $this->popUpMessage()->addMessage(
            'userDeleted',
            'Success',
            'The user has been deleted successfully.<br />All log entries, settings and rights have been removed too.',
            array(
                'modal' => true,
                'height' => 160,
                'width' => 340,
                'dialogClass' => 'info',
            )
        );
    } else {
        $this->popUpMessage()->addMessage(
            'userDeleted',
            'Error',
            'There was an error deleting this user.<br />Please try again.',
            array(
                'modal' => true,
                'height' => 140,
                'width' => 340,
                'dialogClass' => 'info',
            )
        );

    }
}
$this->jQuery()->onLoadCaptureEnd();