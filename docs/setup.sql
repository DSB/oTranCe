CREATE TABLE IF NOT EXISTS `conversions` (`text` LONGTEXT NOT NULL, `id` VARCHAR(128) NOT NULL, CONSTRAINT `PK_CONVERSIONS` PRIMARY KEY (`id`));
CREATE TABLE IF NOT EXISTS `exportlog` (`id` INT UNSIGNED AUTO_INCREMENT NOT NULL, `export_id` VARCHAR(128) NOT NULL, `filename` VARCHAR(255) NOT NULL, CONSTRAINT `PK_EXPORTLOG` PRIMARY KEY (`id`));
CREATE TABLE IF NOT EXISTS `filetemplates` (`id` TINYINT UNSIGNED AUTO_INCREMENT NOT NULL, `name` VARCHAR(50) NOT NULL, `header` LONGTEXT NOT NULL, `footer` LONGTEXT NOT NULL, `content` VARCHAR(255) NOT NULL, `filename` VARCHAR(255) NOT NULL, CONSTRAINT `PK_FILETEMPLATES` PRIMARY KEY (`id`));
CREATE TABLE IF NOT EXISTS `history` (`id` INT UNSIGNED AUTO_INCREMENT NOT NULL, `user_id` SMALLINT UNSIGNED NOT NULL, `dt` DATETIME NOT NULL, `key_id` SMALLINT UNSIGNED NOT NULL, `action` VARCHAR(255) NOT NULL, `lang_id` SMALLINT UNSIGNED NOT NULL, `oldValue` LONGTEXT NOT NULL, `newValue` LONGTEXT NOT NULL, CONSTRAINT `PK_HISTORY` PRIMARY KEY (`id`));
CREATE TABLE IF NOT EXISTS `keys` (`id` INT UNSIGNED AUTO_INCREMENT NOT NULL, `key` VARCHAR(200) NOT NULL, `template_id` TINYINT NOT NULL, `dt` DATETIME NOT NULL, CONSTRAINT `PK_KEYS` PRIMARY KEY (`id`));
CREATE TABLE IF NOT EXISTS `languages` (`id` SMALLINT UNSIGNED AUTO_INCREMENT NOT NULL, `active` BIT DEFAULT 1 NOT NULL, `locale` VARCHAR(5) NOT NULL, `name` VARCHAR(50) NOT NULL, `flag_extension` VARCHAR(255) NOT NULL, `is_fallback` TINYINT DEFAULT 0 NOT NULL, CONSTRAINT `PK_LANGUAGES` PRIMARY KEY (`id`));
CREATE TABLE IF NOT EXISTS `translations` (`lang_id` SMALLINT UNSIGNED NOT NULL, `key_id` SMALLINT UNSIGNED NOT NULL, `text` LONGTEXT NOT NULL, `dt` DATETIME NOT NULL);
CREATE TABLE IF NOT EXISTS `user_languages` (`user_id` INT UNSIGNED NOT NULL, `language_id` INT NOT NULL);
CREATE TABLE IF NOT EXISTS `userrights` (`user_id` INT NOT NULL, `right` VARCHAR(20) NOT NULL, `value` SMALLINT UNSIGNED NOT NULL);
CREATE TABLE IF NOT EXISTS `users` (`id` INT UNSIGNED AUTO_INCREMENT NOT NULL, `username` VARCHAR(50) NOT NULL, `password` VARCHAR(64) NOT NULL, `active` BIT DEFAULT 0 NOT NULL, CONSTRAINT `PK_USERS` PRIMARY KEY (`id`));
CREATE TABLE IF NOT EXISTS `usersettings` (`id` INT UNSIGNED AUTO_INCREMENT NOT NULL, `user_id` SMALLINT UNSIGNED NOT NULL, `setting` VARCHAR(20) NOT NULL, `value` VARCHAR(100) NOT NULL, CONSTRAINT `PK_USERSETTINGS` PRIMARY KEY (`id`));
ALTER TABLE `translations` ADD PRIMARY KEY (`lang_id`, `key_id`);
CREATE INDEX `export_id` ON `exportlog`(`export_id`);
CREATE INDEX `tpl_assign` ON `keys`(`template_id`);
CREATE UNIQUE INDEX `locale` ON `languages`(`locale`);
CREATE UNIQUE INDEX `user_id` ON `user_languages`(`user_id`, `language_id`);
CREATE UNIQUE INDEX `user_id` ON `userrights`(`user_id`, `right`);
CREATE UNIQUE INDEX `username` ON `users`(`username`);
