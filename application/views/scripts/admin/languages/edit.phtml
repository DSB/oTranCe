<?php
$inputFieldMap = array(
    'langName' => 'Language name',
    'langLocale' => 'Language locale',
    'langFlag' => 'Language flag',
);
?>
<h2>Admin - Languages</h2>
<?php
echo $this->partial('admin/head-navi.phtml', array('lang' => $this->lang));
if ($this->languageId == 0) {
    $subTitle = "Create new language";
} else {
    $subTitle = "Edit language \"{$this->langName} ({$this->langLocale})\"";
}
?>
<div>
<?php if ($this->user->hasRight('addLanguage')) {?>
    <button type="button" class="Formbutton" onclick="window.location.href='<?php echo $this->baseUrl();?>/admin_languages/edit/id/0'">
        <?php echo $this->getIcon('plus', '') . ' ' . $this->lang->L_ADD_NEW_LANGUAGE;?>
    </button>
    <br /><br />
<?php } ?>
</div>
<h4><?php echo $subTitle; ?>:</h4>
<form action="<?php echo $this->baseUrl(); ?>/admin_languages/edit/id/<?php echo $this->languageId; ?>/" method="post" enctype="multipart/form-data" id="myForm">
    <table class="bdr more-padding" summary="List of language settings">
        <tr class="thead">
           <th colspan="2">Language settings</th>
        </tr>
        <tr class="row-odd">
            <td>Language is active:</td>
            <td>
                <input type="radio" name="langActive" id="langActiveYes" value="1"<?php echo (!isset($this->langActive) || $this->langActive) ? ' checked="checked"' : ''; ?>/>
                <label for="langActiveYes"> Yes</label>
                &nbsp;&nbsp;
                <input type="radio" name="langActive" id="langActiveNo" value="0"<?php echo (isset($this->langActive) && !$this->langActive) ? ' checked="checked"' : ''; ?>
                    <?php
                    if ($this->fallbackLanguageId == $this->languageId) {
                        echo ' disabled="disabled"';
                    }
                    ?>
                />
                <label for="langActiveNo"> No</label>
            </td>
        </tr>
        <tr class="row-even">
            <td><label for="langLocale">Language locale (e.g. en, de):</label></td>
            <td><input type="text" class="text" name="langLocale" id="langLocale" value="<?php echo $this->escape($this->langLocale); ?>" maxlength="5"/><?php
                if (array_key_exists('langLocale', $this->inputErrors)) { ?>
                    <span class="error"><br/><?php echo implode("<br/>", $this->inputErrors['langLocale']); ?></span>
                <?php }?>
            </td>
        </tr>
        <tr class="row-odd">
            <td><label for="langName">Language name (e.g. English, Deutsch):</label></td>
            <td><input type="text" class="text" name="langName" id="langName" value="<?php echo $this->escape($this->langName); ?>" maxlength="50" /><?php
                if (array_key_exists('langName', $this->inputErrors)) { ?>
                    <span class="error"><br/><?php echo implode("<br/>", $this->inputErrors['langName']); ?></span>
                <?php } ?>
            </td>
        </tr>
        <tr class="row-even">
            <td>
                <label for="langFlag">Language flag:</label><br /><br />
                <?php echo $this->printFlag($this->languageId);?>

            </td>
            <td>
                <input type="file" class="text" name="langFlag" id="langFlag" /><br/>
                <?php if ($this->flagExtension > '') { ?>
                    <button type="button" class="Formbutton" onclick="window.location.href = '<?php echo $this->baseUrl(); ?>/admin_languages/delete.flag/id/<?php echo $this->languageId; ?>/';"><?php echo $this->getIcon('delete', '');?> Delete flag</button>
                    <?php if (array_key_exists('langFlag', $this->inputErrors)) {?>
                        <span class="error"><br/><?php echo implode("<br/>", $this->inputErrors['langFlag']); ?></span>
                    <?php }
                    }?>
            </td>
        </tr>
        <tr class="row-odd">
            <td><input type="hidden" name="flagExt" value="<?php echo $this->flagExtension; ?>"/></td>
            <td>
                <button type="submit" class="Formbutton"><?php echo $this->getIcon('save', '');?> Save</button>
            </td>
        </tr>
    </table>
    <?php
    if ($this->languageId > 0 && $this->user->hasRight('editUsers')) {
        echo $this->partial(
        'admin/languages/language-edit-rights.phtml',
            array(
                'user'              => $this->user,
                'users'             => $this->users,
                'hits'              => $this->userHits,
                'filterUser'        => $this->filterUser,
                'translators'       => $this->translators,
                'languageId'        => $this->languageId,
                'lang'              => $this->lang,
                'offset'            => $this->offset,
                'recordsPerPage'    => $this->recordsPerPage,
                'selRecordsPerPage' => $this->selRecordsPerPage
            )
        );
    }
    ?>
</form>
<?php
if (!empty($this->inputErrors)) {
    $fieldErrors = '<table>';
    foreach ($this->inputErrors as $inputName => $inputError) {
        if (array_key_exists($inputName, $inputFieldMap)) {
            $inputName = $inputFieldMap[$inputName];
        }
        $fieldErrors .= "<tr><td class=\"error\">$inputName:</td><td class=\"error\">";
        $fieldErrors .= implode('<br/>', $inputError);
        $fieldErrors .= "</td></tr>";
    }
    $fieldErrors .= '</table>';
    $this->popUpMessage()->addMessage(
        'settingsNotSaved',
        'Error',
        'Error validating your inputs:<br /><br />' . $fieldErrors
            . '<br /><br />Please correct your input.',
        array(
            'modal' => true,
            'width' => 400,
            'dialogClass' => 'info',
        )
    );
}

if ($this->flag == 'deleted') {
    $this->popUpMessage()->addMessage(
        'settingsSaved',
        'Ok',
        'The image of the flag has been deleted successfully.',
        array(
             'modal' => true,
             'height' => 130,
             'width' => 400,
             'dialogClass' => 'info',
        )
    );
}

if ($this->flag == 'notDeleted') {
    $this->popUpMessage()->addMessage(
        'settingsSaved',
        'Ok',
        'Can\'t delete the image file of the flag.',
        array(
             'modal' => true,
             'height' => 130,
             'width' => 400,
             'dialogClass' => 'info',
        )
    );
}

if (isset($this->creationResult)) {
    $this->showNotification(
        $this->creationResult,
        $this->lang->L_SAVED_SUCCESSFULLY . '.',
        $this->lang->L_SAVED_UNSUCCESSFULLY . '!'
    );
}

